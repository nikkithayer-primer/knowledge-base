<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Base Writer</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <header class="header">
        <div class="header-top">
            <h1>Knowledge Base Writer</h1>
            <button type="button" id="createEntryBtn" class="create-entry-btn">+ Create Entry</button>
        </div>
        <nav class="header-tabs">
            <button type="button" id="csvTab" class="tab-button active">CSV Upload</button>
            <button type="button" id="knowledgeBaseTab" class="tab-button">Knowledge Base</button>
        </nav>
    </header>

    <main class="main-content">
        <div class="content-grid">
            <section class="form-section">
                
                <div id="csvSection" class="tab-content active">
                    <h2>CSV Upload & Data</h2>
                    
                    <!-- Upload Area -->
                    <div class="csv-upload-area">
                        <div class="upload-zone" id="uploadZone">
                            <div class="upload-content">
                                <div class="upload-icon">üìÑ</div>
                                <h3>Drop CSV file here</h3>
                                <p>or click to browse</p>
                                <label for="csvFileInput" style="display: none;">Upload CSV File</label>
                                <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                            </div>
                        </div>
                        
                        <div class="csv-info">
                            <h4>Expected CSV Format:</h4>
                            <p class="format-description">
                                <strong>Columns:</strong> Actor, Action, Target, Sentence, Date Received, Locations, Datetimes
                            </p>
                            <div class="format-example">
                                <code>"Actor","Action","Target","Sentence","Date Received","Locations","Datetimes"</code>
                            </div>
                            <p class="format-description">
                                <small>Supports both quoted and unquoted fields. Accepts "Datetime" or "Datetimes" for the last column.</small>
                            </p>
                        </div>
                    </div>
                    
                    <div id="csvStatus" class="status"></div>
                    
                    <!-- Data Display Area -->
                    <div id="csvDataDisplay" style="display: none;">
                        <div id="csvTableContainer" class="csv-table-container"></div>
                    </div>
                    
                    <div id="csvEmptyState" style="display: block;">
                        <p class="no-data">No CSV data loaded. Upload a CSV file to view data here.</p>
                    </div>
                </div>
                
                <div id="knowledgeBaseSection" class="tab-content">
                    <h2>Knowledge Base</h2>
                    <div id="knowledgeBaseControls" class="knowledge-base-controls">
                        <div class="kb-filters">
                            <label for="searchFilter" class="sr-only">Search entities</label>
                            <input type="text" id="searchFilter" class="kb-search" placeholder="Search entities...">
                            <button type="button" id="refreshKBBtn" class="refresh-btn">üîÑ Refresh</button>
                        </div>
                        <div id="knowledgeBaseStats" class="kb-stats">Loading knowledge base...</div>
                    </div>
                    
                    <!-- Entity Type Tabs -->
                    <div class="kb-entity-tabs">
                        <button type="button" id="peopleKBTab" class="kb-tab-button active" data-entity-type="people">üë§ People</button>
                        <button type="button" id="placesKBTab" class="kb-tab-button" data-entity-type="places">üìç Places</button>
                        <button type="button" id="organizationsKBTab" class="kb-tab-button" data-entity-type="organizations">üè¢ Organizations</button>
                        <button type="button" id="eventsKBTab" class="kb-tab-button" data-entity-type="events">üìÖ Events</button>
                        <button type="button" id="connectionsKBTab" class="kb-tab-button" data-entity-type="connections">üîó Connections</button>
                    </div>
                    
                    <div id="knowledgeBaseContent" class="knowledge-base-content">
                        <div class="kb-tab-content active" id="peopleKBContent">
                            <div id="peopleList" class="kb-entity-list"></div>
                        </div>
                        <div class="kb-tab-content" id="placesKBContent">
                            <div id="placesList" class="kb-entity-list"></div>
                        </div>
                        <div class="kb-tab-content" id="organizationsKBContent">
                            <div id="organizationsList" class="kb-entity-list"></div>
                        </div>
                        <div class="kb-tab-content" id="eventsKBContent">
                            <div id="eventsList" class="kb-entity-list"></div>
                        </div>
                        <div class="kb-tab-content" id="connectionsKBContent">
                            <div id="connectionsList" class="kb-entity-list"></div>
                        </div>
                    </div>
                    <div id="knowledgeBaseEmptyState" style="display: block;">
                        <p class="no-data">No entities in knowledge base. Approve some entities from the Approval Queue to populate your knowledge base.</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Manual Entry Modal -->
    <div id="manualEntryModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2>Create Entry</h2>
                <button type="button" id="closeModalBtn" class="close-modal-btn">&times;</button>
            </div>
            
            <div class="modal-content">
                <form id="dataForm">
                    <input type="hidden" id="entityType" name="entityType" value="">
                    
                    <!-- Wikidata ID field - always shown first for auto-detection -->
                    <div class="form-group wikidata-detection-field">
                        <label for="wikidataIdDetection" class="form-label">Wikidata ID (Optional)</label>
                        <input type="text" id="wikidataIdDetection" name="wikidata_id" class="form-input" placeholder="Q123456 - Enter to auto-detect entity type">
                        <div class="help-text">Enter a Wikidata ID to automatically detect entity type and populate fields</div>
                    </div>
                    
                    <div id="entityTypeIndicator" class="entity-type-indicator hidden">
                        <span id="detectedType" class="detected-type"></span>
                    </div>
                    
                    <!-- Manual entity type selection (shown when no Wikidata ID) -->
                    <div id="manualTypeSelection" class="manual-type-selection">
                        <label class="form-label">Or select entity type manually:</label>
                        <div class="manual-type-buttons">
                            <button type="button" class="manual-type-btn" data-type="people">üë§ Person</button>
                            <button type="button" class="manual-type-btn" data-type="places">üìç Place</button>
                            <button type="button" class="manual-type-btn" data-type="organizations">üè¢ Organization</button>
                        </div>
                    </div>
                    
                    <div id="dynamicFields">
                        <!-- Dynamic fields will be inserted here based on entity type -->
                    </div>
                    
                    <div class="button-group">
                        <button type="submit" id="submitBtn">Save Entry</button>
                    </div>
                </form>
                
                <div id="status" class="status"></div>
            </div>
        </div>
    </div>

    <!-- Connection Creation Modal -->
    <div id="connectionModal" class="modal-overlay" style="display: none;">
        <div class="modal-container connection-modal-container">
            <div class="modal-header">
                <h2>Create Connection</h2>
                <button type="button" class="close-modal-btn" id="closeConnectionModalBtn">&times;</button>
            </div>
            
            <div class="modal-content">
                <form id="connectionForm">
                    <div class="form-section">
                        <h3>From Entity</h3>
                        <div class="form-group">
                            <label for="fromEntityType" class="form-label">Entity Type:</label>
                            <select id="fromEntityType" class="form-input" required>
                                <option value="">Select type...</option>
                                <option value="people">Person</option>
                                <option value="places">Place</option>
                                <option value="organizations">Organization</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fromEntity" class="form-label">Entity:</label>
                            <select id="fromEntity" class="form-input" required disabled>
                                <option value="">Select entity...</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Relationship</h3>
                        <div class="form-group">
                            <label for="relationshipType" class="form-label">Relationship Type:</label>
                            <select id="relationshipType" class="form-input" required disabled>
                                <option value="">Select relationship...</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>To Entity</h3>
                        <div class="form-group">
                            <label for="toEntityType" class="form-label">Entity Type:</label>
                            <select id="toEntityType" class="form-input" required>
                                <option value="">Select type...</option>
                                <option value="people">Person</option>
                                <option value="places">Place</option>
                                <option value="organizations">Organization</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="toEntity" class="form-label">Entity:</label>
                            <select id="toEntity" class="form-input" required disabled>
                                <option value="">Select entity...</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Metadata</h3>
                        <div class="form-group">
                            <label for="connectionSource" class="form-label">Source:</label>
                            <input type="text" id="connectionSource" class="form-input" placeholder="Source of this connection">
                        </div>
                        <div class="form-group">
                            <label for="connectionConfidence" class="form-label">Confidence:</label>
                            <select id="connectionConfidence" class="form-input">
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="action-btn primary">Create Connection</button>
                        <button type="button" class="action-btn secondary" id="cancelConnectionBtn">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
